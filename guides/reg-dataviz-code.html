---
layout: methods-guide
title: "Data Visualization in R"
title_zh: "R æ•°æ®å¯è§†åŒ–å®æˆ˜"
parent_title: "Data Visualization"
parent_title_zh: "æ•°æ®å¯è§†åŒ–"
parent_url: "reg-dataviz.html"
bilingual: true
mathjax: true
---

<h2 id="viz-grammar"><span data-lang="en">The Grammar of Graphics</span><span data-lang="zh">å›¾å½¢çš„è¯­æ³•</span></h2>

<p data-lang="en">Hadley Wickham's "Grammar of Graphics" (ggplot2) revolutionized data visualization by providing a unified, composable language for building plots. Instead of memorizing dozens of specialized functions (barplot, boxplot, scatterplot), you learn a single grammar that combines layers.</p>

<p data-lang="zh">Hadley Wickhamçš„"å›¾å½¢è¯­æ³•"ï¼ˆggplot2ï¼‰é€šè¿‡æä¾›ç»Ÿä¸€çš„ã€å¯ç»„åˆçš„è¯­è¨€æ¥æ„å»ºå›¾è¡¨ï¼Œé©æ–°äº†æ•°æ®å¯è§†åŒ–ã€‚ä¸å…¶è®°ä½å‡ åä¸ªä¸“ç”¨å‡½æ•°ï¼ˆæŸ±çŠ¶å›¾ã€ç®±å½¢å›¾ã€æ•£ç‚¹å›¾ï¼‰ï¼Œæ‚¨å­¦ä¹ ä¸€ä¸ªç»“åˆå±‚çš„å•ä¸€è¯­æ³•ã€‚</p>

<h3 style="margin-top: 20px;"><span data-lang="en">The Seven Layers of ggplot2</span><span data-lang="zh">ggplot2çš„ä¸ƒå±‚</span></h3>

<p data-lang="en">Every ggplot2 visualization combines these layers:</p>

<p data-lang="zh">æ¯ä¸ªggplot2å¯è§†åŒ–éƒ½ç»“åˆäº†è¿™äº›å±‚ï¼š</p>

<ol style="margin: 15px 0; padding-left: 20px;">
  <li data-lang="en"><strong>Data:</strong> Your dataframe. Format: one row per observation, one column per variable.</li>
  <li data-lang="zh"><strong>æ•°æ®ï¼š</strong>æ‚¨çš„æ•°æ®æ¡†ã€‚æ ¼å¼ï¼šæ¯ä¸ªè§‚å¯Ÿä¸€è¡Œï¼Œæ¯ä¸ªå˜é‡ä¸€åˆ—ã€‚</li>

  <li data-lang="en"><strong>Aesthetics (aes):</strong> Map variables to visual properties. aes(x = income, y = votes, color = region, size = population).</li>
  <li data-lang="zh"><strong>ç¾å­¦ï¼ˆaesï¼‰ï¼š</strong>å°†å˜é‡æ˜ å°„åˆ°è§†è§‰å±æ€§ã€‚aes(x = income, y = votes, color = region, size = population)ã€‚</li>

  <li data-lang="en"><strong>Geometries (geom):</strong> Visual marks. geom_point() for scatterplot, geom_line() for line, geom_bar() for bar, etc.</li>
  <li data-lang="zh"><strong>å‡ ä½•ï¼ˆgeomï¼‰ï¼š</strong>è§†è§‰æ ‡è®°ã€‚geom_point()ç”¨äºæ•£ç‚¹å›¾ï¼Œgeom_line()ç”¨äºçº¿æ¡ï¼Œgeom_bar()ç”¨äºæŸ±å­ç­‰ã€‚</li>

  <li data-lang="en"><strong>Scales:</strong> Control appearance of aesthetic mappings. scale_color_brewer() for colors, scale_x_log10() for log axis, etc.</li>
  <li data-lang="zh"><strong>åˆ»åº¦ï¼š</strong>æ§åˆ¶ç¾å­¦æ˜ å°„çš„å¤–è§‚ã€‚scale_color_brewer()ç”¨äºé¢œè‰²ï¼Œscale_x_log10()ç”¨äºå¯¹æ•°è½´ç­‰ã€‚</li>

  <li data-lang="en"><strong>Coordinates:</strong> The coordinate system. coord_cartesian() for zooming, coord_flip() to flip axes, coord_polar() for radial plots.</li>
  <li data-lang="zh"><strong>åæ ‡ï¼š</strong>åæ ‡ç³»ã€‚coord_cartesian()ç”¨äºç¼©æ”¾ï¼Œcoord_flip()ç”¨äºç¿»è½¬è½´ï¼Œcoord_polar()ç”¨äºå¾„å‘å›¾ã€‚</li>

  <li data-lang="en"><strong>Facets:</strong> Small multiples. facet_wrap(~region) to create subplots for each region.</li>
  <li data-lang="zh"><strong>é¢ï¼š</strong>å°å€æ•°ã€‚facet_wrap(~region)ä¸ºæ¯ä¸ªåœ°åŒºåˆ›å»ºå­å›¾ã€‚</li>

  <li data-lang="en"><strong>Theme:</strong> Fine-grained visual styling. theme_minimal() removes gridlines, theme_bw() uses black and white, or customize with theme().</li>
  <li data-lang="zh"><strong>ä¸»é¢˜ï¼š</strong>ç»†ç²’åº¦è§†è§‰æ ·å¼ã€‚theme_minimal()åˆ é™¤ç½‘æ ¼çº¿ï¼Œtheme_bw()ä½¿ç”¨é»‘ç™½ï¼Œæˆ–ä½¿ç”¨theme()è‡ªå®šä¹‰ã€‚</li>
</ol>

<p data-lang="en"><strong>The Magic:</strong> All layers are composable. You start with ggplot(data, aes(...)), add a geom, tweak scales and theme, and you're done. Changes at any layer propagate through the whole plot.</p>

<p data-lang="zh"><strong>ç¥å¥‡ä¹‹å¤„ï¼š</strong>æ‰€æœ‰å±‚éƒ½æ˜¯å¯ç»„åˆçš„ã€‚æ‚¨ä»ggplot(data, aes(...))å¼€å§‹ï¼Œæ·»åŠ ä¸€ä¸ªgeomï¼Œè°ƒæ•´åˆ»åº¦å’Œä¸»é¢˜ï¼Œå®Œæˆã€‚ä»»ä½•å±‚çš„æ›´æ”¹éƒ½ä¼šä¼ æ’­åˆ°æ•´ä¸ªå›¾è¡¨ã€‚</p>

<h2 id="viz-chooser"><span data-lang="en">Interactive Chart Type Selector</span><span data-lang="zh">äº¤äº’å¼å›¾è¡¨ç±»å‹é€‰æ‹©å™¨</span></h2>

<p data-lang="en">Click a chart type below to see when to use it and sample code.</p>

<p data-lang="zh">ç‚¹å‡»ä¸‹é¢çš„å›¾è¡¨ç±»å‹æŸ¥çœ‹ä½•æ—¶ä½¿ç”¨å®ƒå’Œç¤ºä¾‹ä»£ç ã€‚</p>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
  <div class="chart-card" data-chart="scatter" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“Š</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Scatter</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">æ•£ç‚¹å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">2 continuous</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">2ä¸ªè¿ç»­</p>
  </div>

  <div class="chart-card" data-chart="line" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“ˆ</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Line</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">çº¿å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">Trends over time</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">éšæ—¶é—´çš„è¶‹åŠ¿</p>
  </div>

  <div class="chart-card" data-chart="bar" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“‹</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Bar</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">æŸ±çŠ¶å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">Categorical values</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">åˆ†ç±»å€¼</p>
  </div>

  <div class="chart-card" data-chart="histogram" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ””</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Histogram</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">ç›´æ–¹å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">1 continuous</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">1ä¸ªè¿ç»­</p>
  </div>

  <div class="chart-card" data-chart="box" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“¦</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Boxplot</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">ç®±çº¿å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">Compare dists</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">æ¯”è¾ƒåˆ†å¸ƒ</p>
  </div>

  <div class="chart-card" data-chart="violin" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ»</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Violin</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">å°æç´å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">Density per group</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">æ¯ç»„å¯†åº¦</p>
  </div>

  <div class="chart-card" data-chart="heatmap" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ”¥</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Heatmap</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">çƒ­åŠ›å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">2D intensity</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">2Då¼ºåº¦</p>
  </div>

  <div class="chart-card" data-chart="map" style="padding: 20px; border-radius: 8px; background-color: var(--cream); border: 2px solid transparent; cursor: pointer; text-align: center; transition: all 0.2s;">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸ—ºï¸</div>
    <p data-lang="en" style="margin: 0; font-weight: bold;">Map</p>
    <p data-lang="zh" style="margin: 0; font-weight: bold;">åœ°å›¾</p>
    <p data-lang="en" style="font-size: 0.8em; color: var(--ink-faded);">Geographic</p>
    <p data-lang="zh" style="font-size: 0.8em; color: var(--ink-faded);">åœ°ç†ä½ç½®</p>
  </div>
</div>

<div id="chart-details" style="margin-top: 30px; padding: 20px; background-color: var(--paper); border-radius: 8px; border-left: 4px solid var(--gold);">
  <p data-lang="en" style="color: var(--ink-faded);">Click a chart type above to see details.</p>
  <p data-lang="zh" style="color: var(--ink-faded);">ç‚¹å‡»ä¸Šé¢çš„å›¾è¡¨ç±»å‹æŸ¥çœ‹è¯¦æƒ…ã€‚</p>
</div>

<h2 id="viz-ggplot"><span data-lang="en">Key ggplot2 Patterns</span><span data-lang="zh">å…³é”®ggplot2æ¨¡å¼</span></h2>

<h3 style="margin-top: 20px;"><span data-lang="en">Scatter Plot with Trend Line</span><span data-lang="zh">å¸¦è¶‹åŠ¿çº¿çš„æ•£ç‚¹å›¾</span></h3>

<p data-lang="en">Show the relationship between two continuous variables, with group differences highlighted by color. Add a regression line to reveal the trend.</p>

<p data-lang="zh">æ˜¾ç¤ºä¸¤ä¸ªè¿ç»­å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œç”¨é¢œè‰²çªå‡ºæ˜¾ç¤ºç»„å·®å¼‚ã€‚æ·»åŠ å›å½’çº¿ä»¥æ˜¾ç¤ºè¶‹åŠ¿ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">library(ggplot2)
library(ggthemes)

# Scatter with regression line and CI bands
ggplot(data, aes(x = income, y = vote_share, color = region)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "lm", se = TRUE, color = "black", alpha = 0.2) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Income and Vote Share by Region",
       subtitle = "With 95% confidence band",
       x = "Median Income ($K)",
       y = "Vote Share (%)",
       color = "Region",
       caption = "Source: Electoral data") +
  theme_minimal() +
  theme(legend.position = "right",
        plot.title = element_text(size = 14, face = "bold"))</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Histograms & Density Plots</span><span data-lang="zh">ç›´æ–¹å›¾å’Œå¯†åº¦å›¾</span></h3>

<p data-lang="en">Show the distribution of a single continuous variable. Use density curves for smoothness, histograms for counts.</p>

<p data-lang="zh">æ˜¾ç¤ºå•ä¸ªè¿ç»­å˜é‡çš„åˆ†å¸ƒã€‚ä½¿ç”¨å¯†åº¦æ›²çº¿ä»¥è·å¾—å¹³æ»‘æ€§ï¼Œä½¿ç”¨ç›´æ–¹å›¾ä»¥è·å¾—è®¡æ•°ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Overlaid density curves for groups
ggplot(data, aes(x = income, fill = region)) +
  geom_density(alpha = 0.4) +
  facet_wrap(~region) +
  scale_fill_brewer(palette = "Pastel1") +
  labs(x = "Income ($K)", y = "Density") +
  theme_minimal()

# Histogram with counts
ggplot(data, aes(x = age)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  labs(title = "Age Distribution",
       x = "Age (years)", y = "Count") +
  theme_classic()</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Boxplots for Group Comparison</span><span data-lang="zh">ç”¨äºç»„æ¯”è¾ƒçš„ç®±çº¿å›¾</span></h3>

<p data-lang="en">Compare distributions across groups. Boxplot shows median (bold line), quartiles (box), and outliers. Violin plot adds density curves.</p>

<p data-lang="zh">æ¯”è¾ƒå„ç»„çš„åˆ†å¸ƒã€‚ç®±çº¿å›¾æ˜¾ç¤ºä¸­ä½æ•°ï¼ˆç²—çº¿ï¼‰ã€å››åˆ†ä½æ•°ï¼ˆç®±ï¼‰å’Œå¼‚å¸¸å€¼ã€‚å°æç´å›¾æ·»åŠ å¯†åº¦æ›²çº¿ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Boxplot
ggplot(data, aes(x = region, y = income, fill = region)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.3, size = 1) +
  scale_fill_brewer(palette = "Set2") +
  labs(y = "Income ($K)", x = "Region") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot (like boxplot but shows density)
ggplot(data, aes(x = region, y = income, fill = region)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.1, fill = "white") +
  scale_fill_brewer(palette = "Set2") +
  labs(y = "Income ($K)", x = "Region") +
  theme_minimal() +
  theme(legend.position = "none")</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Bar Plots for Categorical Data</span><span data-lang="zh">åˆ†ç±»æ•°æ®çš„æŸ±çŠ¶å›¾</span></h3>

<p data-lang="en">Show counts or summarized values across categories. Use geom_bar() for counts, geom_col() for pre-summarized values.</p>

<p data-lang="zh">æ˜¾ç¤ºå„ç±»åˆ«çš„è®¡æ•°æˆ–æ±‡æ€»å€¼ã€‚å¯¹è®¡æ•°ä½¿ç”¨geom_bar()ï¼Œå¯¹é¢„æ±‡æ€»å€¼ä½¿ç”¨geom_col()ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Stacked bar plot
ggplot(data, aes(x = region, fill = party)) +
  geom_bar(position = "fill") +
  labs(title = "Party Composition by Region",
       x = "Region", y = "Proportion",
       fill = "Party") +
  scale_fill_brewer(palette = "Dark2") +
  theme_minimal()

# Grouped bar plot
ggplot(data, aes(x = region, y = vote_share, fill = party)) +
  geom_col(position = "dodge") +
  labs(y = "Vote Share", x = "Region", fill = "Party") +
  theme_minimal()</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Time Series & Line Plots</span><span data-lang="zh">æ—¶é—´åºåˆ—å’Œçº¿å›¾</span></h3>

<p data-lang="en">Show trends over time. Use color or facets to compare groups.</p>

<p data-lang="zh">æ˜¾ç¤ºéšæ—¶é—´çš„è¶‹åŠ¿ã€‚ä½¿ç”¨é¢œè‰²æˆ–é¢æ¥æ¯”è¾ƒç»„ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">ggplot(data, aes(x = year, y = gdp, color = country)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "GDP Growth Over Time",
       x = "Year", y = "GDP ($ Billions)",
       color = "Country") +
  theme_minimal()

# Small multiples (facets)
ggplot(data, aes(x = year, y = gdp)) +
  geom_line(color = "steelblue", size = 1) +
  facet_wrap(~country, scales = "free_y") +
  labs(x = "Year", y = "GDP ($B)") +
  theme_minimal()</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Heatmaps for 2D Intensity</span><span data-lang="zh">ç”¨äº2Då¼ºåº¦çš„çƒ­åŠ›å›¾</span></h3>

<p data-lang="en">Show intensity (color) across two dimensions. Perfect for correlation matrices or cross-tabulations.</p>

<p data-lang="zh">æ˜¾ç¤ºä¸¤ä¸ªç»´åº¦çš„å¼ºåº¦ï¼ˆé¢œè‰²ï¼‰ã€‚éå¸¸é€‚åˆç›¸å…³çŸ©é˜µæˆ–äº¤å‰åˆ¶è¡¨ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Heatmap of correlations
library(reshape2)

# Compute correlation matrix
corr_matrix <- cor(data[, c("income", "education", "age", "turnout")])
corr_melted <- melt(corr_matrix)

ggplot(corr_melted, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red",
                       midpoint = 0, limits = c(-1, 1)) +
  labs(title = "Correlation Matrix", x = "", y = "", fill = "Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))</code>
</pre>

<h2 id="viz-publish"><span data-lang="en">Publication-Quality Figures</span><span data-lang="zh">å‡ºç‰ˆè´¨é‡å›¾è¡¨</span></h2>

<h3 style="margin-top: 20px;"><span data-lang="en">Fonts & Themes</span><span data-lang="zh">å­—ä½“å’Œä¸»é¢˜</span></h3>

<p data-lang="en">For academic papers, use clean themes and custom fonts. The ggthemes package provides publication-ready templates.</p>

<p data-lang="zh">å¯¹äºå­¦æœ¯è®ºæ–‡ï¼Œä½¿ç”¨å¹²å‡€çš„ä¸»é¢˜å’Œè‡ªå®šä¹‰å­—ä½“ã€‚ggthemesåŒ…æä¾›å‡ºç‰ˆå°±ç»ªçš„æ¨¡æ¿ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">library(ggplot2)
library(ggthemes)

# Classic themes
p <- ggplot(data, aes(x = income, y = votes)) +
  geom_point() +
  geom_smooth(method = "lm")

# Economist theme (Economist magazine style)
p + theme_economist() + scale_color_economist()

# Tufte theme (minimalist, Edward Tufte inspired)
p + theme_tufte()

# The Economist with custom fonts (requires extrafont or showtext)
library(extrafont)
p + theme_economist(base_family = "Helvetica") +
  labs(title = "Main Finding",
       subtitle = "Subtitle here",
       caption = "Source: Data source")</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Color-Blind Safe Palettes</span><span data-lang="zh">è‰²ç›²å‹å¥½çš„è°ƒè‰²æ¿</span></h3>

<p data-lang="en">Always use color-blind safe palettes for publication. Viridis and ColorBrewer are excellent choices.</p>

<p data-lang="zh">å‡ºç‰ˆæ—¶å§‹ç»ˆä½¿ç”¨è‰²ç›²å‹å¥½çš„è°ƒè‰²æ¿ã€‚Viridiså’ŒColorBreweræ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Viridis (perceptually uniform, color-blind safe)
ggplot(data, aes(x = x, y = y, color = group)) +
  geom_point() +
  scale_color_viridis_d(option = "plasma")

# ColorBrewer
ggplot(data, aes(x = region, fill = outcome)) +
  geom_bar() +
  scale_fill_brewer(palette = "Set2")  # Safe for colorblind

# Check palette with simulator
library(colorBlindness)
cvdPlot(p)  # Simulate colorblind vision</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Saving Publication-Ready Figures</span><span data-lang="zh">ä¿å­˜å‡ºç‰ˆå°±ç»ªçš„å›¾è¡¨</span></h3>

<p data-lang="en">Use ggsave() for high-quality output. Always save as PDF for papers (vector format, scalable).</p>

<p data-lang="zh">ä½¿ç”¨ggsave()è·å¾—é«˜è´¨é‡è¾“å‡ºã€‚å§‹ç»ˆä¿å­˜ä¸ºPDFæ ¼å¼ï¼ˆçŸ¢é‡æ ¼å¼ã€å¯æ‰©å±•ï¼‰ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en"># Create plot
p <- ggplot(data, aes(x = income, y = votes)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(title = "Income and Voting",
       x = "Income ($K)", y = "Vote Share (%)") +
  theme_minimal()

# Save as PDF (vector) for papers
ggsave("figure1.pdf", plot = p, width = 8, height = 5, dpi = 300)

# Save as PNG (raster) for presentations
ggsave("figure1.png", plot = p, width = 8, height = 5, dpi = 300)

# Batch save multiple plots
plots <- list(p1, p2, p3)
for (i in seq_along(plots)) {
  ggsave(paste0("figure", i, ".pdf"), plots[[i]], width = 8, height = 5)
}</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Annotations & Labels</span><span data-lang="zh">æ³¨é‡Šå’Œæ ‡ç­¾</span></h3>

<p data-lang="en">Highlight key findings with text annotations, arrows, and highlights.</p>

<p data-lang="zh">ç”¨æ–‡æœ¬æ³¨é‡Šã€ç®­å¤´å’Œé«˜äº®çªå‡ºæ˜¾ç¤ºå…³é”®å‘ç°ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">ggplot(data, aes(x = income, y = votes)) +
  geom_point(alpha = 0.6) +
  # Highlight a specific region
  geom_rect(aes(xmin = 50, xmax = 70, ymin = -Inf, ymax = Inf),
            alpha = 0.1, fill = "yellow", inherit.aes = FALSE) +
  # Add annotation text
  annotate("text", x = 60, y = 80,
           label = "High income\nstates vote conservative",
           size = 4, color = "darkred", fontface = "bold") +
  # Add arrow pointing to annotation
  annotate("segment", x = 65, xend = 68, y = 75, yend = 85,
           arrow = arrow(length = unit(0.2, "cm")), color = "darkred") +
  labs(x = "Income ($K)", y = "Vote Share (%)") +
  theme_minimal()</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Combining Plots: patchwork</span><span data-lang="zh">ç»„åˆå›¾è¡¨ï¼špatchwork</span></h3>

<p data-lang="en">Use patchwork to arrange multiple plots together with a shared title and caption.</p>

<p data-lang="zh">ä½¿ç”¨patchworkå°†å¤šä¸ªå›¾è¡¨ä¸å…±äº«æ ‡é¢˜å’Œæ ‡æ³¨ä¸€èµ·æ’åˆ—ã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">library(patchwork)

# Create multiple plots
p1 <- ggplot(data, aes(x = income, y = votes)) +
  geom_point() + geom_smooth(method = "lm") +
  labs(title = "Income vs Vote Share", x = "Income", y = "Votes")

p2 <- ggplot(data, aes(x = education, y = votes)) +
  geom_point() + geom_smooth(method = "lm") +
  labs(title = "Education vs Vote Share", x = "Education", y = "Votes")

p3 <- ggplot(data, aes(x = age, y = votes)) +
  geom_point() + geom_smooth(method = "lm") +
  labs(title = "Age vs Vote Share", x = "Age", y = "Votes")

# Arrange with patchwork
combined <- (p1 + p2) / p3 +
  plot_annotation(title = "Predictors of Voting Behavior",
                  subtitle = "Linear relationships with vote share",
                  caption = "Source: Electoral survey",
                  theme = theme(plot.title = element_text(size = 16, face = "bold")))

# Save combined figure
ggsave("figure_combined.pdf", combined, width = 12, height = 10)</code>
</pre>

<h2 id="viz-interactive"><span data-lang="en">Interactive Visualization</span><span data-lang="zh">äº¤äº’å¼å¯è§†åŒ–</span></h2>

<h3 style="margin-top: 20px;"><span data-lang="en">ggplotly: Adding Interactivity to ggplot</span><span data-lang="zh">ggplotlyï¼šä¸ºggplotæ·»åŠ äº¤äº’æ€§</span></h3>

<p data-lang="en">Convert any ggplot to an interactive plot with hover tooltips, zooming, and panning. Perfect for exploratory analysis and reports.</p>

<p data-lang="zh">å°†ä»»ä½•ggplotè½¬æ¢ä¸ºå…·æœ‰æ‚¬åœå·¥å…·æç¤ºã€ç¼©æ”¾å’Œå¹³ç§»çš„äº¤äº’å¼å›¾è¡¨ã€‚éå¸¸é€‚åˆæ¢ç´¢æ€§åˆ†æå’ŒæŠ¥å‘Šã€‚</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">library(plotly)

# Create ggplot
p <- ggplot(data, aes(x = income, y = votes, color = region, size = population)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Income and Votes",
       x = "Income ($K)", y = "Vote Share (%)")

# Convert to interactive
ggplotly(p, tooltip = c("x", "y", "color", "size"))</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">Shiny: Interactive Web Applications</span><span data-lang="zh">Shinyï¼šäº¤äº’å¼Webåº”ç”¨</span></h3>

<p data-lang="en">Build interactive dashboards where users can filter, select variables, and explore data. Here's a minimal example:</p>

<p data-lang="zh">æ„å»ºäº¤äº’å¼ä»ªè¡¨æ¿ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­è¿‡æ»¤ã€é€‰æ‹©å˜é‡å’Œæµè§ˆæ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€å°ç¤ºä¾‹ï¼š</p>

<pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.9em;">
<code data-lang="en">library(shiny)

ui <- fluidPage(
  titlePanel("Electoral Data Explorer"),
  sidebarLayout(
    sidebarPanel(
      selectInput("xvar", "X Variable:",
                  choices = c("income", "education", "age")),
      selectInput("yvar", "Y Variable:",
                  choices = c("votes", "turnout", "campaign_spending"))
    ),
    mainPanel(
      plotOutput("scatter")
    )
  )
)

server <- function(input, output) {
  output$scatter <- renderPlot({
    ggplot(data, aes_string(x = input$xvar, y = input$yvar)) +
      geom_point(alpha = 0.6) +
      geom_smooth(method = "lm") +
      theme_minimal()
  })
}

shinyApp(ui, server)</code>
</pre>

<h3 style="margin-top: 20px;"><span data-lang="en">When to Use Interactive Visualization</span><span data-lang="zh">ä½•æ—¶ä½¿ç”¨äº¤äº’å¼å¯è§†åŒ–</span></h3>

<p data-lang="en"><strong>Good for exploration:</strong> Shiny dashboards and interactive plots let users explore hypotheses and discover patterns.</p>

<p data-lang="zh"><strong>é€‚åˆæ¢ç´¢ï¼š</strong>Shinyä»ªè¡¨æ¿å’Œäº¤äº’å¼å›¾è¡¨è®©ç”¨æˆ·æ¢ç´¢å‡è®¾å’Œå‘ç°æ¨¡å¼ã€‚</p>

<p data-lang="en"><strong>Avoid in publications:</strong> Print papers can't interact. Use static, high-quality figures with annotations to communicate key findings.</p>

<p data-lang="zh"><strong>åœ¨å‡ºç‰ˆç‰©ä¸­é¿å…ï¼š</strong>æ‰“å°è®ºæ–‡æ— æ³•äº¤äº’ã€‚ä½¿ç”¨å¸¦æ³¨é‡Šçš„é™æ€ã€é«˜è´¨é‡å›¾è¡¨æ¥ä¼ è¾¾å…³é”®å‘ç°ã€‚</p>

<p data-lang="en"><strong>Good for reports:</strong> HTML reports (R Markdown, Quarto) can embed interactive plots. Use with cautionâ€”too much interactivity can distract from the main message.</p>

<p data-lang="zh"><strong>é€‚åˆæŠ¥å‘Šï¼š</strong>HTMLæŠ¥å‘Šï¼ˆR Markdownã€Quartoï¼‰å¯ä»¥åµŒå…¥äº¤äº’å¼å›¾è¡¨ã€‚è°¨æ…ä½¿ç”¨â€”â€”è¿‡å¤šäº¤äº’å¯èƒ½ä¼šåˆ†æ•£ä¸»è¦ä¿¡æ¯ã€‚</p>

<div class="insight-box">
  <p data-lang="en"><strong>Key Takeaway:</strong> Master the grammar of graphics (ggplot2) as your core skill. It's composable, flexible, and makes publication-quality figures easy. Learn themes and color palettes for aesthetics, facets for small multiples, and geoms for different data types. Use interactive visualization for exploration, but static plots for communication. Always save figures at high resolution (DPI) and in vector formats (PDF) for papers.</p>
  <p data-lang="zh"><strong>å…³é”®è¦ç‚¹ï¼š</strong>æŒæ¡å›¾å½¢è¯­æ³•ï¼ˆggplot2ï¼‰ä½œä¸ºæ‚¨çš„æ ¸å¿ƒæŠ€èƒ½ã€‚å®ƒæ˜¯å¯ç»„åˆçš„ã€çµæ´»çš„ï¼Œä½¿å‡ºç‰ˆè´¨é‡çš„å›¾è¡¨å˜å¾—å®¹æ˜“ã€‚å­¦ä¹ ä¸»é¢˜å’Œè°ƒè‰²æ¿ä»¥è·å¾—ç¾å­¦ã€é¢ä»¥è·å¾—å°å€æ•°ã€geomsä»¥è·å¾—ä¸åŒçš„æ•°æ®ç±»å‹ã€‚ä½¿ç”¨äº¤äº’å¼å¯è§†åŒ–è¿›è¡Œæ¢ç´¢ï¼Œä½†ä½¿ç”¨é™æ€å›¾è¡¨è¿›è¡Œæ²Ÿé€šã€‚å§‹ç»ˆä»¥é«˜åˆ†è¾¨ç‡ï¼ˆDPIï¼‰å’ŒçŸ¢é‡æ ¼å¼ï¼ˆPDFï¼‰ä¿å­˜è®ºæ–‡å›¾è¡¨ã€‚</p>
</div>

<script>
// Chart type selector
const chartCards = document.querySelectorAll('.chart-card');
const chartDetails = document.getElementById('chart-details');

const chartInfo = {
  scatter: {
    enTitle: 'Scatter Plot',
    zhTitle: 'æ•£ç‚¹å›¾',
    enUse: 'Use to visualize the relationship between two continuous variables. Add color for groups, size for a third variable, and a trend line (geom_smooth) to reveal patterns.',
    zhUse: 'ç”¨äºå¯è§†åŒ–ä¸¤ä¸ªè¿ç»­å˜é‡ä¹‹é—´çš„å…³ç³»ã€‚æ·»åŠ é¢œè‰²ä»¥è¡¨ç¤ºç»„ï¼Œå¤§å°ä»¥è¡¨ç¤ºç¬¬ä¸‰ä¸ªå˜é‡ï¼Œå¹¶æ·»åŠ è¶‹åŠ¿çº¿ï¼ˆgeom_smoothï¼‰ä»¥æ˜¾ç¤ºæ¨¡å¼ã€‚',
    code: `ggplot(data, aes(x = income, y = votes, color = region)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_brewer(palette = "Set2") +
  labs(x = "Income", y = "Vote Share") +
  theme_minimal()`
  },
  line: {
    enTitle: 'Line Plot',
    zhTitle: 'çº¿å›¾',
    enUse: 'Perfect for time series data. Show trends over time with one line per group. Use color or facets to distinguish between groups.',
    zhUse: 'éå¸¸é€‚åˆæ—¶é—´åºåˆ—æ•°æ®ã€‚ç”¨ä¸€æ¡çº¿æ˜¾ç¤ºæ¯ç»„çš„è¶‹åŠ¿ã€‚ä½¿ç”¨é¢œè‰²æˆ–é¢æ¥åŒºåˆ†ç»„ã€‚',
    code: `ggplot(data, aes(x = year, y = gdp, color = country)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_color_brewer(palette = "Set1") +
  labs(x = "Year", y = "GDP") +
  theme_minimal()`
  },
  bar: {
    enTitle: 'Bar Plot',
    zhTitle: 'æŸ±çŠ¶å›¾',
    enUse: 'Compare values across categories. Use geom_col() for pre-computed values, geom_bar() for counts. Stack or group bars to show composition.',
    zhUse: 'æ¯”è¾ƒå„ç±»åˆ«çš„å€¼ã€‚å¯¹é¢„è®¡ç®—å€¼ä½¿ç”¨geom_col()ï¼Œå¯¹è®¡æ•°ä½¿ç”¨geom_bar()ã€‚å †å æˆ–åˆ†ç»„æŸ±å­ä»¥æ˜¾ç¤ºæ„æˆã€‚',
    code: `ggplot(data, aes(x = region, y = vote_share, fill = party)) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2") +
  labs(x = "Region", y = "Vote Share", fill = "Party") +
  theme_minimal()`
  },
  histogram: {
    enTitle: 'Histogram',
    zhTitle: 'ç›´æ–¹å›¾',
    enUse: 'Show the distribution of a single continuous variable. Use geom_histogram() for counts or geom_density() for smooth density curves.',
    zhUse: 'æ˜¾ç¤ºå•ä¸ªè¿ç»­å˜é‡çš„åˆ†å¸ƒã€‚ä½¿ç”¨geom_histogram()è·å¾—è®¡æ•°æˆ–geom_density()è·å¾—å¹³æ»‘å¯†åº¦æ›²çº¿ã€‚',
    code: `ggplot(data, aes(x = income, fill = region)) +
  geom_density(alpha = 0.4) +
  scale_fill_brewer(palette = "Set2") +
  labs(x = "Income", y = "Density") +
  theme_minimal()`
  },
  box: {
    enTitle: 'Boxplot',
    zhTitle: 'ç®±çº¿å›¾',
    enUse: 'Compare distributions across groups. Shows median, quartiles, and outliers. Add geom_jitter() to overlay raw points.',
    zhUse: 'æ¯”è¾ƒå„ç»„çš„åˆ†å¸ƒã€‚æ˜¾ç¤ºä¸­ä½æ•°ã€å››åˆ†ä½æ•°å’Œå¼‚å¸¸å€¼ã€‚æ·»åŠ geom_jitter()ä»¥è¦†ç›–åŸå§‹ç‚¹ã€‚',
    code: `ggplot(data, aes(x = region, y = income, fill = region)) +
  geom_boxplot(alpha = 0.7) +
  geom_jitter(width = 0.2, alpha = 0.3) +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal() +
  theme(legend.position = "none")`
  },
  violin: {
    enTitle: 'Violin Plot',
    zhTitle: 'å°æç´å›¾',
    enUse: 'Like a boxplot but shows the full density distribution. Better for non-normal or multimodal distributions.',
    zhUse: 'åƒç®±çº¿å›¾ä¸€æ ·ï¼Œä½†æ˜¾ç¤ºå®Œæ•´çš„å¯†åº¦åˆ†å¸ƒã€‚å¯¹äºéæ­£æ€æˆ–å¤šæ¨¡æ€åˆ†å¸ƒæ›´å¥½ã€‚',
    code: `ggplot(data, aes(x = region, y = income, fill = region)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.1) +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal() +
  theme(legend.position = "none")`
  },
  heatmap: {
    enTitle: 'Heatmap',
    zhTitle: 'çƒ­åŠ›å›¾',
    enUse: 'Show intensity or magnitude across two dimensions. Perfect for correlation matrices, cross-tabulations, or geographic data.',
    zhUse: 'æ˜¾ç¤ºä¸¤ä¸ªç»´åº¦çš„å¼ºåº¦æˆ–å¤§å°ã€‚éå¸¸é€‚åˆç›¸å…³çŸ©é˜µã€äº¤å‰åˆ¶è¡¨æˆ–åœ°ç†æ•°æ®ã€‚',
    code: `ggplot(corr_data, aes(x = var1, y = var2, fill = correlation)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red") +
  labs(x = "", y = "", fill = "Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))`
  },
  map: {
    enTitle: 'Geographic Map',
    zhTitle: 'åœ°ç†åœ°å›¾',
    enUse: 'Visualize data spatially. Use sf (simple features) for shapefiles and geom_sf() to plot boundaries and color by values.',
    zhUse: 'åœ¨ç©ºé—´ä¸Šå¯è§†åŒ–æ•°æ®ã€‚ä½¿ç”¨sfï¼ˆç®€å•ç‰¹å¾ï¼‰å¤„ç†shapeæ–‡ä»¶ï¼Œä½¿ç”¨geom_sf()ç»˜åˆ¶è¾¹ç•Œå¹¶æŒ‰å€¼ç€è‰²ã€‚',
    code: `library(sf)
ggplot(states_sf) +
  geom_sf(aes(fill = vote_share)) +
  scale_fill_gradient(low = "red", high = "blue") +
  labs(fill = "Vote Share", title = "Electoral Map") +
  theme_minimal()`
  }
};

chartCards.forEach(card => {
  card.addEventListener('click', () => {
    // Remove previous selection
    chartCards.forEach(c => c.style.borderColor = 'transparent');

    // Highlight selected card
    card.style.borderColor = 'var(--gold)';
    card.style.backgroundColor = 'var(--parchment)';

    const chartType = card.dataset.chart;
    const info = chartInfo[chartType];

    const enTitle = card.querySelector('[data-lang="en"]').textContent;
    const zhTitle = card.querySelector('[data-lang="zh"]').textContent;

    chartDetails.innerHTML = `
      <h3 style="margin-top: 0;">
        <span data-lang="en">${info.enTitle}</span>
        <span data-lang="zh">${info.zhTitle}</span>
      </h3>
      <p data-lang="en"><strong>When to use:</strong> ${info.enUse}</p>
      <p data-lang="zh"><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong>${info.zhUse}</p>
      <p data-lang="en"><strong>Example code:</strong></p>
      <p data-lang="zh"><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
      <pre style="background-color: var(--paper); padding: 15px; border-radius: 4px; border-left: 4px solid var(--leather); overflow-x: auto; font-family: var(--mono); font-size: 0.85em;">
<code>${info.code}</code>
      </pre>
    `;
  });
});
</script>
