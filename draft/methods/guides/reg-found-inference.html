---
layout: methods-guide
title: "Hypothesis Testing Step by Step"
title_zh: "假设检验：一步一步来"
parent_title: "Statistical Foundations"
parent_title_zh: "统计基础"
parent_url: "reg-foundations.html"
bilingual: true
mathjax: true
---

<h2 id="ht-logic">
  <span data-lang="en">The Logic of Null Hypothesis Significance Testing (NHST)</span>
  <span data-lang="zh">零假设显著性检验(NHST)的逻辑</span>
</h2>

<p data-lang="en">
  NHST follows a peculiar but powerful logic: <strong>reductio ad absurdum</strong> (proof by contradiction).
  We assume the null hypothesis H₀ is true, then ask: "How surprising is our observed data under that assumption?"
  If the data is very unlikely under H₀, we reject H₀ in favor of the alternative H₁.
</p>

<p data-lang="zh">
  NHST遵循一个奇特但强大的逻辑：<strong>反证法</strong>(用矛盾证明)。
  我们假设零假设H₀为真，然后问："在这个假设下，我们的观察数据有多令人惊讶？"
  如果数据在H₀下非常不可能，我们拒绝H₀而支持备择假设H₁。
</p>

<p data-lang="en" style="margin-top: 16px;">
  <strong>Criminal Trial Analogy:</strong> H₀ is "defendant is innocent" (default assumption).
  Evidence (data) must demonstrate guilt "beyond a reasonable doubt" (p < 0.05) to convict.
  Failing to convict ≠ proving innocence; it just means insufficient evidence.
</p>

<p data-lang="zh" style="margin-top: 16px;">
  <strong>刑事审判类比：</strong> H₀是"被告无罪"(默认假设)。
  证据(数据)必须"毫无合理疑问地"(p < 0.05)证明有罪才能定罪。
  未能定罪≠证明无罪；这只意味着证据不足。
</p>

<p data-lang="en" style="margin-top: 16px; font-weight: 500;">
  <span data-lang="en">Error Types and Power</span>
  <span data-lang="zh">错误类型和功效</span>
</p>

<table style="width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 13px;">
  <tr style="background: var(--ink-ghost);">
    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--ink);"></th>
    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--ink);">
      <span data-lang="en">H₀ is True</span>
      <span data-lang="zh">H₀为真</span>
    </th>
    <th style="padding: 10px; text-align: left; border-bottom: 2px solid var(--ink);">
      <span data-lang="en">H₁ is True (Effect Exists)</span>
      <span data-lang="zh">H₁为真(存在效应)</span>
    </th>
  </tr>
  <tr>
    <td style="padding: 10px; border-bottom: 1px solid var(--ink-ghost); font-weight: 500;">
      <span data-lang="en">Reject H₀</span>
      <span data-lang="zh">拒绝H₀</span>
    </td>
    <td style="padding: 10px; border-bottom: 1px solid var(--ink-ghost);">
      <strong>Type I Error (α)</strong>
      <br><span data-lang="en">False positive</span>
      <span data-lang="zh">假阳性</span>
    </td>
    <td style="padding: 10px; border-bottom: 1px solid var(--ink-ghost);">
      <strong>Correct ✓</strong>
      <br><span data-lang="en">Power = 1 − β</span>
      <span data-lang="zh">功效 = 1 − β</span>
    </td>
  </tr>
  <tr>
    <td style="padding: 10px; font-weight: 500;">
      <span data-lang="en">Fail to Reject H₀</span>
      <span data-lang="zh">未能拒绝H₀</span>
    </td>
    <td style="padding: 10px;">
      <strong>Correct ✓</strong>
      <br><span data-lang="en">Specificity = 1 − α</span>
      <span data-lang="zh">特异性 = 1 − α</span>
    </td>
    <td style="padding: 10px;">
      <strong>Type II Error (β)</strong>
      <br><span data-lang="en">False negative</span>
      <span data-lang="zh">假阴性</span>
    </td>
  </tr>
</table>

<ul style="margin: 16px 0; padding-left: 24px; font-size: 14px;">
  <li>
    <strong data-lang="en">α (Type I Error):</strong>
    <strong data-lang="zh">α(第一类错误)：</strong>
    <span data-lang="en">Probability of false alarm. Standard choice: α = 0.05 (5%).</span>
    <span data-lang="zh">虚报的概率。标准选择：α = 0.05(5%)。</span>
  </li>

  <li style="margin-top: 8px;">
    <strong data-lang="en">β (Type II Error):</strong>
    <strong data-lang="zh">β(第二类错误)：</strong>
    <span data-lang="en">Probability of missing a real effect. Often set to β = 0.20 (20%), giving Power = 80%.</span>
    <span data-lang="zh">错过真实效应的概率。通常设置为β = 0.20(20%)，给出Power = 80%。</span>
  </li>

  <li style="margin-top: 8px;">
    <strong data-lang="en">Power:</strong>
    <span data-lang="en">1 − β = probability of detecting a real effect (if it exists).</span>
    <span data-lang="zh">1 − β = 检测真实效应的概率(如果它存在)。</span>
  </li>
</ul>

<div class="insight-box">
  <p data-lang="en">
    <strong>Why 0.05?</strong> It's arbitrary but convention. Choosing α = 0.05 means we tolerate a 5% chance
    of false alarms across hypothesis tests. Some fields (e.g., particle physics) use α = 0.0000003 for discovery;
    exploratory social science might use α = 0.10. Choose based on the cost of errors in your context.
  </p>
  <p data-lang="zh">
    <strong>为什么是0.05？</strong> 这是武断的但是约定俗成。选择α = 0.05意味着我们容忍在假设检验中有5%的虚报机会。
    有些领域(如粒子物理学)使用α = 0.0000003进行发现；
    探索性社会科学可能使用α = 0.10。根据你的背景下错误的成本来选择。
  </p>
</div>

<hr style="border:none; border-top:1px solid var(--ink-ghost); margin:32px 0;">

<h2 id="ht-pvalue">
  <span data-lang="en">What is a p-value? (Interactive)</span>
  <span data-lang="zh">什么是p值？(交互式)</span>
</h2>

<p data-lang="en">
  <strong>Definition:</strong> The p-value is the probability of observing data as extreme or more extreme than what you actually observed,
  <em>assuming H₀ is true.</em>
</p>

<p data-lang="zh">
  <strong>定义：</strong> p值是观察到与你实际观察到的数据一样极端或更极端的数据的概率，
  <em>假设H₀为真。</em>
</p>

<p data-lang="en" style="margin-top: 12px; font-size: 13px; color: var(--ink-faded);">
  <strong>Common Misinterpretation:</strong> p-value is NOT "the probability that H₀ is true" or "the probability your result was due to chance."
  It's the probability of the data under H₀, not the probability of H₀ given the data.
</p>

<p data-lang="zh" style="margin-top: 12px; font-size: 13px; color: var(--ink-faded);">
  <strong>常见误解：</strong> p值不是"H₀为真的概率"或"你的结果是由于偶然的概率"。
  它是给定H₀的数据的概率，而不是给定数据的H₀的概率。
</p>

<div class="sim-panel" style="background: var(--parchment); padding: 20px; border-radius: 8px; margin: 20px 0;">
  <div class="ctrl-group">
    <label class="ctrl-label" data-lang="en">Test Statistic (z):</label>
    <label class="ctrl-label" data-lang="zh">检验统计量(z)：</label>
    <input type="range" id="z_value" min="-4" max="4" step="0.1" value="1.96"
           style="width:100%; margin: 8px 0;" oninput="updatePValuePlot()">
    <span class="ctrl-val" id="z_display">1.96</span>
  </div>
  <p style="font-size: 12px; color: var(--ink-faded); margin-top: 8px;">
    <span data-lang="en">(Move left for negative evidence against H₀, right for positive)</span>
    <span data-lang="zh">(向左移动反对H₀的证据，向右移动正证据)</span>
  </p>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
  <div>
    <p style="text-align: center; font-weight: 500; margin-bottom: 8px;" data-lang="en">Two-Tailed Test</p>
    <p style="text-align: center; font-weight: 500; margin-bottom: 8px;" data-lang="zh">双尾检验</p>
    <canvas id="pvalueChart" style="max-width: 100%;"></canvas>
  </div>
  <div>
    <p style="text-align: center; font-weight: 500; margin-bottom: 8px;" data-lang="en">Decision Region</p>
    <p style="text-align: center; font-weight: 500; margin-bottom: 8px;" data-lang="zh">决策区域</p>
    <canvas id="decisionChart" style="max-width: 100%;"></canvas>
  </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0;">
  <div class="stat-chip">
    <div class="slabel" data-lang="en">p-value (two-tailed)</div>
    <div class="slabel" data-lang="zh">p值(双尾)</div>
    <div class="sval" id="pvalue_display">0.050</div>
  </div>
  <div class="stat-chip">
    <div class="slabel" data-lang="en">Significant at α=0.05?</div>
    <div class="slabel" data-lang="zh">在α=0.05时显著？</div>
    <div class="sval" id="sig_display" style="color: var(--gold);">Borderline</div>
  </div>
</div>

<div class="insight-box">
  <p data-lang="en">
    <strong>How to interpret:</strong>
    <br>• <strong>p < 0.05:</strong> The data is unlikely under H₀ (less than 5% chance). Reject H₀. Evidence for H₁.
    <br>• <strong>p > 0.05:</strong> The data is reasonably likely under H₀. Fail to reject H₀. Insufficient evidence for H₁ (but H₀ might be false anyway).
    <br>• <strong>p = 0.05 exactly:</strong> You're at the boundary. Report the exact p and let readers decide; or note "marginally significant."
  </p>
  <p data-lang="zh">
    <strong>如何解释：</strong>
    <br>• <strong>p < 0.05：</strong> 数据在H₀下不太可能(少于5%的机会)。拒绝H₀。H₁的证据。
    <br>• <strong>p > 0.05：</strong> 数据在H₀下相当可能。未能拒绝H₀。H₁证据不足(但H₀可能仍然为假)。
    <br>• <strong>p = 0.05恰好：</strong> 你在边界上。报告确切的p并让读者决定；或注意"边际显著"。
  </p>
</div>

<hr style="border:none; border-top:1px solid var(--ink-ghost); margin:32px 0;">

<h2 id="ht-steps">
  <span data-lang="en">The 5 Steps of Hypothesis Testing</span>
  <span data-lang="zh">假设检验的5个步骤</span>
</h2>

<div style="background: var(--paper); padding: 20px; border-radius: 8px; border-left: 4px solid var(--warm);">

<p style="margin-bottom: 0; font-weight: 500;">
  <strong data-lang="en">Step 1: State Hypotheses</strong>
  <strong data-lang="zh">步骤1：陈述假设</strong>
</p>

<p data-lang="en" style="margin: 8px 0 0 0; font-size: 13px;">
  Define H₀ (what we assume by default) and H₁ (what we're trying to demonstrate).
  <br><strong>Example:</strong> H₀: political ads have no effect on voting (θ = 0.5)
  <br>H₁: political ads change voting behavior (θ ≠ 0.5)
</p>

<p data-lang="zh" style="margin: 8px 0 0 0; font-size: 13px;">
  定义H₀(我们默认假设)和H₁(我们试图证明的)。
  <br><strong>示例：</strong> H₀：政治广告对投票无影响(θ = 0.5)
  <br>H₁：政治广告改变投票行为(θ ≠ 0.5)
</p>

<hr style="border:none; border-top: 1px solid var(--ink-ghost); margin: 12px 0;">

<p style="margin-bottom: 0; margin-top: 16px; font-weight: 500;">
  <strong data-lang="en">Step 2: Choose Test and Significance Level</strong>
  <strong data-lang="zh">步骤2：选择检验和显著性水平</strong>
</p>

<p data-lang="en" style="margin: 8px 0 0 0; font-size: 13px;">
  Pick an appropriate test statistic (z, t, χ², F, etc.) and α level.
  <br><strong>Example:</strong> We'll use a z-test for proportions, α = 0.05.
</p>

<p data-lang="zh" style="margin: 8px 0 0 0; font-size: 13px;">
  选择适当的检验统计量(z、t、χ²、F等)和α水平。
  <br><strong>示例：</strong> 我们将使用比例的z检验，α = 0.05。
</p>

<hr style="border:none; border-top: 1px solid var(--ink-ghost); margin: 12px 0;">

<p style="margin-bottom: 0; margin-top: 16px; font-weight: 500;">
  <strong data-lang="en">Step 3: Compute Test Statistic from Data</strong>
  <strong data-lang="zh">步骤3：从数据计算检验统计量</strong>
</p>

<p data-lang="en" style="margin: 8px 0 0 0; font-size: 13px;">
  <strong>Example:</strong> In a survey of 200 people, 112 said yes to "would political ads affect you?"
  <br>Sample proportion p̂ = 112/200 = 0.56
  <br>Standard error SE = √[0.5 × 0.5 / 200] ≈ 0.0354
  <br>z = (0.56 − 0.5) / 0.0354 ≈ 1.70
</p>

<p data-lang="zh" style="margin: 8px 0 0 0; font-size: 13px;">
  <strong>示例：</strong> 在对200人的调查中，112人说"政治广告会影响你吗？"为是
  <br>样本比例 p̂ = 112/200 = 0.56
  <br>标准误 SE = √[0.5 × 0.5 / 200] ≈ 0.0354
  <br>z = (0.56 − 0.5) / 0.0354 ≈ 1.70
</p>

<hr style="border:none; border-top: 1px solid var(--ink-ghost); margin: 12px 0;">

<p style="margin-bottom: 0; margin-top: 16px; font-weight: 500;">
  <strong data-lang="en">Step 4: Find p-value or Compare to Critical Value</strong>
  <strong data-lang="zh">步骤4：找到p值或与临界值比较</strong>
</p>

<p data-lang="en" style="margin: 8px 0 0 0; font-size: 13px;">
  For a two-tailed test with z = 1.70: p-value ≈ P(Z ≤ −1.70) + P(Z ≥ 1.70) ≈ 0.089
  <br>(Use a z-table, calculator, or R: pnorm(-1.70)*2 ≈ 0.089)
  <br>Alternatively, critical value for α = 0.05 is z = ±1.96. Since 1.70 < 1.96, we don't reject.
</p>

<p data-lang="zh" style="margin: 8px 0 0 0; font-size: 13px;">
  对于z = 1.70的双尾检验：p值 ≈ P(Z ≤ −1.70) + P(Z ≥ 1.70) ≈ 0.089
  <br>(使用z表、计算器或R：pnorm(-1.70)*2 ≈ 0.089)
  <br>或者，α = 0.05的临界值是z = ±1.96。由于1.70 < 1.96，我们不拒绝。
</p>

<hr style="border:none; border-top: 1px solid var(--ink-ghost); margin: 12px 0;">

<p style="margin-bottom: 0; margin-top: 16px; font-weight: 500;">
  <strong data-lang="en">Step 5: Make Decision and Interpret</strong>
  <strong data-lang="zh">步骤5：做出决定并解释</strong>
</p>

<p data-lang="en" style="margin: 8px 0 0 0; font-size: 13px;">
  Since p = 0.089 > 0.05, we <strong>fail to reject H₀</strong>.
  <br><strong>Conclusion:</strong> We do not have sufficient evidence to conclude that political ads affect voting behavior.
  (But this doesn't prove ads have no effect; we just didn't find strong enough evidence.)
</p>

<p data-lang="zh" style="margin: 8px 0 0 0; font-size: 13px;">
  由于p = 0.089 > 0.05，我们<strong>未能拒绝H₀</strong>。
  <br><strong>结论：</strong> 我们没有充分证据得出政治广告影响投票行为的结论。
  (但这不能证明广告没有影响；我们只是没有找到足够强的证据。)
</p>

</div>

<hr style="border:none; border-top:1px solid var(--ink-ghost); margin:32px 0;">

<h2 id="ht-power">
  <span data-lang="en">Power Analysis (Interactive)</span>
  <span data-lang="zh">功效分析(交互式)</span>
</h2>

<p data-lang="en">
  Before collecting data, we can plan our sample size using power analysis.
  Two normal curves below: one for H₀ (green, centered at 0) and one for H₁ (blue, centered at effect size δ).
  Adjust effect size and sample size to see how power (area under H₁ to the right of critical value) changes.
</p>

<p data-lang="zh">
  在收集数据之前，我们可以使用功效分析来规划样本大小。
  下面有两条正态曲线：一条用于H₀(绿色，以0为中心)，一条用于H₁(蓝色，以效应大小δ为中心)。
  调整效应大小和样本大小来看功效(H₁下临界值右侧的面积)如何变化。
</p>

<div class="sim-panel" style="background: var(--parchment); padding: 20px; border-radius: 8px; margin: 20px 0;">
  <div class="ctrl-group">
    <label class="ctrl-label" data-lang="en">Effect Size (δ):</label>
    <label class="ctrl-label" data-lang="zh">效应大小(δ)：</label>
    <input type="range" id="effect_size" min="0" max="3" step="0.1" value="0.5"
           style="width:100%; margin: 8px 0;" oninput="updatePowerPlot()">
    <span class="ctrl-val" id="effect_display">0.5</span>
    <p style="font-size: 12px; color: var(--ink-faded); margin-top: 4px;">
      <span data-lang="en">δ = 0.2 (small), 0.5 (medium), 0.8 (large)</span>
      <span data-lang="zh">δ = 0.2(小)，0.5(中)，0.8(大)</span>
    </p>
  </div>

  <div class="ctrl-group" style="margin-top: 16px;">
    <label class="ctrl-label" data-lang="en">Sample Size (n):</label>
    <label class="ctrl-label" data-lang="zh">样本大小(n)：</label>
    <input type="range" id="sample_size" min="20" max="500" step="10" value="100"
           style="width:100%; margin: 8px 0;" oninput="updatePowerPlot()">
    <span class="ctrl-val" id="n_display">100</span>
  </div>
</div>

<div style="margin: 20px 0;">
  <canvas id="powerChart" style="max-width: 100%; max-height: 400px;"></canvas>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 20px 0;">
  <div class="stat-chip">
    <div class="slabel" data-lang="en">Type I Error (α)</div>
    <div class="slabel" data-lang="zh">第一类错误(α)</div>
    <div class="sval">0.050</div>
  </div>
  <div class="stat-chip">
    <div class="slabel" data-lang="en">Type II Error (β)</div>
    <div class="slabel" data-lang="zh">第二类错误(β)</div>
    <div class="sval" id="beta_display">0.200</div>
  </div>
  <div class="stat-chip">
    <div class="slabel" data-lang="en">Power (1 − β)</div>
    <div class="slabel" data-lang="zh">功效(1 − β)</div>
    <div class="sval" id="power_display">0.80</div>
  </div>
</div>

<div class="insight-box">
  <p data-lang="en">
    <strong>Key Takeaways:</strong>
    <br>• <strong>Larger effect size:</strong> Easier to detect. Power increases.
    <br>• <strong>Larger sample size:</strong> More precision. Power increases.
    <br>• <strong>Trade-off:</strong> Want high power (>0.80)? Collect more data or choose α = 0.10 (less stringent).
    <br>• <strong>Pre-planning:</strong> Use power analysis <em>before</em> data collection to determine required sample size.
  </p>
  <p data-lang="zh">
    <strong>关键要点：</strong>
    <br>• <strong>更大的效应大小：</strong> 更容易检测。功效增加。
    <br>• <strong>更大的样本大小：</strong> 更高的精度。功效增加。
    <br>• <strong>权衡：</strong> 想要高功效(>0.80)？收集更多数据或选择α = 0.10(不那么严格)。
    <br>• <strong>预规划：</strong> 在数据收集<em>之前</em>使用功效分析来确定所需的样本大小。
  </p>
</div>

<hr style="border:none; border-top:1px solid var(--ink-ghost); margin:32px 0;">

<h2 id="ht-problems">
  <span data-lang="en">Common Pitfalls and Misinterpretations</span>
  <span data-lang="zh">常见陷阱和误解</span>
</h2>

<p data-lang="en" style="margin-top: 16px;">
  <strong>"If p > 0.05, there is no effect"</strong>
</p>

<p data-lang="zh" style="margin-top: 16px;">
  <strong>"如果p > 0.05，就没有效应"</strong>
</p>

<p data-lang="en" style="margin: 8px 0;">
  <strong>WRONG.</strong> Absence of evidence (p > 0.05) is not evidence of absence.
  You may have insufficient power, a small true effect, or too much noise.
  Report the effect size and confidence interval, not just the p-value.
</p>

<p data-lang="zh" style="margin: 8px 0;">
  <strong>错误。</strong> 证据缺失(p > 0.05)不是缺失证据。
  你可能没有足够的功效、真实效应很小，或者噪声太多。
  报告效应大小和置信区间，而不仅仅是p值。
</p>

<p data-lang="en" style="margin-top: 16px;">
  <strong>p-hacking and the Garden of Forking Paths</strong>
</p>

<p data-lang="zh" style="margin-top: 16px;">
  <strong>p-hacking和分支路径森林</strong>
</p>

<p data-lang="en" style="margin: 8px 0;">
  If you test many hypotheses without adjusting for multiple comparisons,
  some will be "significant" by chance. With 20 tests and α = 0.05, you expect 1 false positive.
  <br><strong>Solution:</strong> Pre-register hypotheses before analyzing data. Use multiple comparisons corrections (Bonferroni, FDR).
</p>

<p data-lang="zh" style="margin: 8px 0;">
  如果你测试许多假设而不调整多重比较，
  其中一些会偶然"显著"。进行20个检验且α = 0.05，你期望1个假阳性。
  <br><strong>解决方案：</strong> 在分析数据前预注册假设。使用多重比较校正(Bonferroni、FDR)。
</p>

<p data-lang="en" style="margin-top: 16px;">
  <strong>The Replication Crisis</strong>
</p>

<p data-lang="zh" style="margin-top: 16px;">
  <strong>复制危机</strong>
</p>

<p data-lang="en" style="margin: 8px 0;">
  Many published findings don't replicate. Reasons: publication bias (journals prefer p < 0.05),
  p-hacking, small sample sizes, and flexibility in analysis.
  <br><strong>Better practices:</strong>
</p>

<p data-lang="zh" style="margin: 8px 0;">
  许多已发表的发现无法复制。原因：发表偏差(期刊倾向于p < 0.05)，
  p-hacking、小样本量和分析灵活性。
  <br><strong>更好的做法：</strong>
</p>

<ul style="margin: 12px 0 16px 0; padding-left: 24px;">
  <li>
    <span data-lang="en"><strong>Pre-register</strong> hypotheses and analysis plan at <a href="https://osf.io" style="color: var(--warm); text-decoration: underline;">OSF.io</a> or clinicaltrials.gov before data collection.</span>
    <span data-lang="zh"><strong>预注册</strong> 在<a href="https://osf.io" style="color: var(--warm); text-decoration: underline;">OSF.io</a>或clinicaltrials.gov上的假设和分析计划。</span>
  </li>

  <li style="margin-top: 8px;">
    <span data-lang="en"><strong>Report effect sizes and CIs</strong> alongside p-values. "Significant" ≠ "important."</span>
    <span data-lang="zh"><strong>报告效应大小和置信区间</strong> 与p值一起。"显著" ≠ "重要"。</span>
  </li>

  <li style="margin-top: 8px;">
    <span data-lang="en"><strong>Use Bayesian methods</strong> to incorporate prior knowledge and avoid the multiple testing problem.</span>
    <span data-lang="zh"><strong>使用贝叶斯方法</strong> 纳入先验知识并避免多重测试问题。</span>
  </li>

  <li style="margin-top: 8px;">
    <span data-lang="en"><strong>Plan sample sizes</strong> based on power analysis (not convenience).</span>
    <span data-lang="zh"><strong>根据功效分析规划样本大小</strong> (而不是便利性)。</span>
  </li>

  <li style="margin-top: 8px;">
    <span data-lang="en"><strong>Replicate</strong> on independent data or in preregistered follow-up studies.</span>
    <span data-lang="zh"><strong>在独立数据上复制或在预注册的后续研究中复制。</strong></span>
  </li>
</ul>

<div class="insight-box">
  <p data-lang="en">
    <strong>The Bottom Line:</strong>
    NHST is not the final word on truth. It's a tool for filtering noise from signal,
    but only if used responsibly. Combine p-values with effect sizes, confidence intervals,
    pre-registration, and replication to build cumulative scientific knowledge.
    See <a href="reg-bayes-prior.html" style="color: var(--warm); text-decoration: underline;">Bayesian methods</a> for an alternative approach.
  </p>
  <p data-lang="zh">
    <strong>底线：</strong>
    NHST不是真理的最终评判。这是一种从噪声中过滤信号的工具，
    但前提是负责任地使用。将p值与效应大小、置信区间、
    预注册和复制相结合，以积累科学知识。
    参见<a href="reg-bayes-prior.html" style="color: var(--warm); text-decoration: underline;">贝叶斯方法</a>了解替代方法。
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// Standard normal CDF approximation
function normCDF(z) {
  const a1 =  0.254829592, a2 = -0.284496736, a3 =  1.421413741;
  const a4 = -1.453152027, a5 =  1.061405429, p = 0.3275911;
  const sign = z < 0 ? -1 : 1;
  z = Math.abs(z);
  const t = 1 / (1 + p * z);
  const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-z * z);
  return 0.5 * (1 + sign * y);
}

function normPDF(z) {
  return Math.exp(-0.5 * z * z) / Math.sqrt(2 * Math.PI);
}

let pvalueChart = null;
let decisionChart = null;
let powerChart = null;

function updatePValuePlot() {
  const z = parseFloat(document.getElementById('z_value').value);
  document.getElementById('z_display').textContent = z.toFixed(2);

  // Two-tailed p-value
  const pval = 2 * (1 - normCDF(Math.abs(z)));
  document.getElementById('pvalue_display').textContent = pval.toFixed(4);

  const sig = pval < 0.05 ? 'Significant ✓' : pval < 0.10 ? 'Borderline' : 'Not Significant';
  const color = pval < 0.05 ? 'var(--gold)' : pval < 0.10 ? 'var(--warm)' : 'var(--ink-faded)';
  document.getElementById('sig_display').textContent = sig;
  document.getElementById('sig_display').style.color = color;

  // Plot: Normal curve with shaded tails
  if (pvalueChart) pvalueChart.destroy();

  const zVals = [];
  const pdfVals = [];
  for (let i = -4; i <= 4; i += 0.1) {
    zVals.push(i.toFixed(1));
    pdfVals.push(normPDF(i));
  }

  pvalueChart = new Chart(document.getElementById('pvalueChart'), {
    type: 'line',
    data: {
      labels: zVals,
      datasets: [{
        label: 'N(0,1) under H₀',
        data: pdfVals,
        borderColor: 'var(--leather)',
        backgroundColor: 'rgba(150, 100, 80, 0.1)',
        pointRadius: 0,
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        annotation: {
          drawTime: 'afterDatasetsDraw'
        }
      },
      scales: {
        x: { title: { display: true, text: 'z' }, min: -4, max: 4 },
        y: { title: { display: true, text: 'Density' }, min: 0, max: 0.5 }
      }
    }
  });

  // Decision chart
  if (decisionChart) decisionChart.destroy();

  const criticalZ = 1.96;
  const zRange = [];
  const colors = [];

  for (let i = -4; i <= 4; i += 0.2) {
    zRange.push(i);
    if (Math.abs(i) > criticalZ) {
      colors.push('rgba(200, 100, 100, 0.8)'); // Rejection region (red)
    } else {
      colors.push('rgba(100, 200, 100, 0.8)'); // Acceptance region (green)
    }
  }

  decisionChart = new Chart(document.getElementById('decisionChart'), {
    type: 'bar',
    data: {
      labels: zRange.map(z => z.toFixed(1)),
      datasets: [{
        label: 'Decision Region',
        data: zRange.map(() => 0.4),
        backgroundColor: colors,
        borderWidth: 0
      }]
    },
    options: {
      indexAxis: 'x',
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        x: { title: { display: true, text: 'z' }, min: -4, max: 4 },
        y: { display: false }
      }
    }
  });
}

function updatePowerPlot() {
  const delta = parseFloat(document.getElementById('effect_size').value);
  const n = parseInt(document.getElementById('sample_size').value);

  document.getElementById('effect_display').textContent = delta.toFixed(1);
  document.getElementById('n_display').textContent = n;

  // Critical value for α = 0.05, two-tailed
  const criticalZ = 1.96;

  // Standard error decreases with sqrt(n)
  const se = 1 / Math.sqrt(n);

  // Type II error: probability of not detecting effect
  // Under H₁: test statistic is centered at delta/se
  const testStatCenter = delta / se;
  const beta = normCDF(criticalZ - testStatCenter);
  const power = 1 - beta;

  document.getElementById('beta_display').textContent = beta.toFixed(3);
  document.getElementById('power_display').textContent = power.toFixed(3);

  if (powerChart) powerChart.destroy();

  // Generate two normal curves
  const zVals = [];
  const h0Curve = [];
  const h1Curve = [];

  for (let i = -4; i <= 6; i += 0.2) {
    zVals.push(i.toFixed(2));
    h0Curve.push(normPDF(i) * se);
    h1Curve.push(normPDF(i - testStatCenter) * se);
  }

  powerChart = new Chart(document.getElementById('powerChart'), {
    type: 'line',
    data: {
      labels: zVals,
      datasets: [{
        label: 'H₀ (Effect = 0)',
        data: h0Curve,
        borderColor: 'var(--ink-ghost)',
        backgroundColor: 'rgba(150, 150, 150, 0.15)',
        pointRadius: 0,
        fill: true,
        tension: 0.3
      }, {
        label: 'H₁ (Effect = ' + delta.toFixed(1) + ')',
        data: h1Curve,
        borderColor: 'var(--warm)',
        backgroundColor: 'rgba(225, 150, 100, 0.15)',
        pointRadius: 0,
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true, position: 'top' },
        title: { display: true, text: 'Critical Region at z = ±1.96 (α = 0.05); Blue area = Power' }
      },
      scales: {
        x: { title: { display: true, text: 'Standardized Test Statistic' } },
        y: { title: { display: true, text: 'Density' } }
      }
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  updatePValuePlot();
  updatePowerPlot();
});
</script>
